[![NixOS](https://img.shields.io/badge/NixOS-Unstable-blue.svg)](https://nixos.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**This is a specialized fork of [linux-osu-stable-installer](https://github.com/Kitty-Hivens/linux-osu-stable-installer), rewritten purely for NixOS.**

It removes all standard Linux logic (`apt`, `pacman`, manual Wine downloads) and replaces it with **Nix Derivations**. It ensures `osu!` runs with the correct system Wine, audio latency tweaks, and fully working map importing.

**Language:** [English](README.md) | [–†—É—Å—Å–∫–∏–π](README_RU.md)

## ‚ú® Features

* **Nix-Native:** Dependencies (Wine Staging, Winetricks, Curl, Yad) are handled by Nix. No global pollution.
* **Smart Wrapper:** The executable automatically sets `STAGING_AUDIO_DURATION` and `PULSE_LATENCY_MSEC` for low latency.
* **Working Importer:** Double-clicking `.osz` or `.osk` files in your file manager works out of the box.
* **Self-contained:** If the game isn't installed, running `osu` triggers the GUI installer automatically.

---

## üì¶ Installation

Choose the method that matches your NixOS configuration.

### Method 1: Nix Flakes (Recommended)

Add this repository to your `flake.nix` inputs:

```nix
{
  inputs = {
    nixpkgs.url = "github:nixos/nixpkgs/nixos-unstable";
    
    # Add this input
    osu-nixos.url = "github:afanetd/linux-osu-stable-installer-nixos";
  };

  outputs = { self, nixpkgs, osu-nixos, ... }: {
    nixosConfigurations.my-machine = nixpkgs.lib.nixosSystem {
      system = "x86_64-linux";
      modules = [
        ./configuration.nix
        {
          environment.systemPackages = [
            # Install the package
            osu-nixos.packages.x86_64-linux.default
          ];
        }
      ];
    };
  };
}

```

Then rebuild your system:

```bash
sudo nixos-rebuild switch --flake .#my-machine

```

### Method 2: Manual / `configuration.nix`

1. Clone this repository to `/etc/nixos/pkgs/osu` (or any persistent location).
2. Add the package to your `configuration.nix`:

```nix
{ pkgs, ... }: {
  environment.systemPackages = [
    (pkgs.callPackage ./path/to/cloned/repo/default.nix {})
  ];
}

```

3. Rebuild: `sudo nixos-rebuild switch`.

---

## üéÆ How to Use

1. Open your terminal.
2. Type `osu` in terminal.
3. **First Run:** A GUI installer will appear. Click "Ok" to install the game.
* *Note: Just follow the prompts. The installer will download osu! and set up the prefix, .desktop file.*


4. **Subsequent Runs:** The game launches immediately.

### Importing Maps/Skins

Simply **double-click** any `.osz` or `.osk` file in your file manager (Dolphin, Thunar, Nautilus). The wrapper will automatically pass it to the game.

---

### Troubleshooting

If the game doesn't start, check the logs generated by the wrapper:

```bash
cat /tmp/osu.log

```

## üè≥Ô∏è Installer CLI Flags

You can run the installer manually with arguments:

```bash
osu-install [options]
````

### Available options

| Flag             | Argument | Description                                        |
| ---------------- | -------- | -------------------------------------------------- |
| `-s`, `--silent` | ‚Äî        | Run installer **without GUI** (CLI only)           |
| `-d`, `--dir`    | `<path>` | Custom install directory for osu!                  |
| `--renderer`     | `<name>` | Force Wine renderer (e.g. `gl`, `vulkan`)          |
| `--driver`       | `<name>` | Force Wine audio driver                            |
| `--font`         | `<name>` | Install and use specific font (e.g. `"Noto Sans"`) |
| `--no-rpc`       | ‚Äî        | Disable Discord Rich Presence installation         |
| `-h`, `--help`   | ‚Äî        | Show help message and exit                         |

---

### Examples

Install with custom font:

```bash
osu-install --silent --font "Noto Sans"
```

Install to custom directory:

```bash
osu-install --silent --dir "$HOME/Games/osu"
```

Disable Discord Rich Presence:

```bash
osu-install --silent --no-rpc
```


## üìú Credits

* **Original Author:** [Kitty-Hivens](https://github.com/Kitty-Hivens)
* **NixOS Port:** [afanetd](https://github.com/afanetd)

