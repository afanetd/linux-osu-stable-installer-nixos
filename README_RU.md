# osu! Linux Installer (Stable)

**Версия:** v4.0.0
**Лицензия:** MIT
**Языки:** [English](README.md) | [Русский](README_RU.md)

Комплексный Bash-скрипт для автоматизированного развертывания и конфигурации клиента osu! (stable) в среде Linux. Решение ориентировано на минимальную задержку (low-latency), корректную интеграцию с системным окружением и поддержку современных графических стеков.

Скрипт использует `yad` (Yet Another Dialog) для предоставления графического интерфейса настройки перед установкой.

## Основные возможности

* **Мультиплатформенность:** Автоматическое разрешение зависимостей для Arch Linux, Debian/Ubuntu, Fedora и Void Linux.
* **Графический стек:**
    * **OpenGL:** Стандартный рендер.
    * **DXVK:** Трансляция DirectX 9/11 в Vulkan для снижения нагрузки на драйвер.
* **Оконная система:**
    * **X11:** Стандартный драйвер Wine (рекомендуется для стабильности).
    * **Wayland:** Включает нативный драйвер Wayland в реестре Wine для устранения задержек XWayland.
* **Шрифты и Локализация:**
    * Автоматическая загрузка и патчинг реестра для CJK-шрифтов (WenQuanYi, Noto Sans, Koruri).
    * Исправление отображения иероглифов в списках карт и чате.
    * Включение сглаживания шрифтов (Font Smoothing).
* **Аудио и Latency:** Применение переменных окружения для минимизации задержки звука в PulseAudio/PipeWire.
* **Системная интеграция:**
    * Создание `.desktop` файла.
    * Регистрация MIME-типов: автоматический импорт `.osz`, `.osk` и `.osr` файлов по двойному клику.
    * Скрипт-обертка (Wrapper) для предотвращения запуска дублирующих копий игры.

## Системные требования

* **ОС:** Linux (Arch, Debian, Fedora, Void или производные). NixOS поддерживается частично (требуется ручная установка `yad`).
* **Зависимости:** `curl`, `unzip`, `winetricks`, `yad`. (Устанавливаются автоматически на поддерживаемых системах).
* **Wine:** Рекомендуется `wine-staging` для лучшей производительности, но поддерживается и стабильная ветка.

## Установка

### 1. Клонирование репозитория
```bash
git clone https://github.com/Kitty-Hivens/linux-osu-stable-installer.git
cd linux-osu-stable-installer
````

### 2\. Запуск инсталлятора

```bash
chmod +x osu!install.sh
./osu!install.sh
```

> **Примечание:** Скрипт запрашивает права суперпользователя (через `pkexec`) **только** для установки отсутствующих системных пакетов (драйверов, `yad`, `wine`) через ваш пакетный менеджер. Сама игра устанавливается в домашнюю директорию пользователя.

## Параметры конфигурации (Dashboard)

При запуске откроется окно конфигурации. Ниже приведено описание доступных параметров:

| Параметр | Описание |
| :--- | :--- |
| **Install Location** | Директория для префикса Wine. По умолчанию: `~/.wine-osu`. |
| **Wine Binary** | Выбор исполняемого файла Wine. Скрипт автоматически определяет наличие `wine-staging`. Также можно указать путь к кастомному бинарнику. |
| **Graphics API** | **OpenGL**: Стандартный рендер. Рекомендуется для старого оборудования.<br>**DXVK**: Трансляция в Vulkan. Рекомендуется для современных GPU для снижения задержки ввода. |
| **Window Driver** | **X11**: Стандартный драйвер. Совместим со всеми оконными менеджерами.<br>**Wayland**: Нативный драйвер Wine. Исключает оверхед XWayland. *Экспериментальная функция.* |
| **Fonts** | Выбор шрифта для замены стандартного UI-шрифта Windows. Решает проблему отображения CJK символов. |
| **Discord RPC** | Установка моста (Bridge) для отображения статуса игры ("Rich Presence") в Discord Linux-клиенте. |

## Технические детали реализации

### Обертка запуска (Wrapper)

Инсталлятор создает скрипт-обертку по пути `~/.config/osu-importer/osu_importer_wrapper.sh`. Этот скрипт выполняет следующие функции:

1.  **Управление переменными окружения:**
      * `STAGING_AUDIO_DURATION=10000` — буфер аудио.
      * `PULSE_LATENCY_MSEC=60` — оптимизация PulseAudio.
      * `LC_ALL=en_US.UTF-8` — принудительная локаль.
2.  **Обработка файлов:** Проверяет, запущен ли процесс игры. Если да — передает файл через IPC; если нет — запускает игру с файлом в качестве аргумента.

### Удаление (Uninstallation)

Игра полностью изолирована в префиксе. Для удаления:

1.  Удалить папку префикса (По умолчанию: `~/.wine-osu`).
2.  Удалить файлы интеграции:
    ```bash
    rm ~/.local/share/applications/osu-stable.desktop
    rm ~/.local/share/applications/osu-importer.desktop
    rm -rf ~/.config/osu-importer
    ```

## Известные проблемы

  * **NixOS:** Автоматическая установка зависимостей невозможна из-за архитектуры ОС. Установите `yad` через `configuration.nix` или `nix-env` перед запуском.
  * **Wayland Driver:** При использовании нативного драйвера Wayland курсор может быть ограничен областью окна некорректно на некоторых композиторах (Hyprland, Sway). В случае проблем используйте **X11** или отредактируйте ключ реестра `HKCU\Software\Wine\Drivers\Graphics`.

## Лицензия

Распространяется под лицензией MIT. Подробности см. в файле [LICENSE](https://www.google.com/search?q=LICENSE).
